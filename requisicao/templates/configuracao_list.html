{% extends 'base.html' %}
{% block title %}
| Grupo Golden Sat |
{% endblock %}

{% include 'components/_header.html' %}
{% block content %}
<style>
    .card-status {
        position: relative;
        transition: transform 0.3s ease;
        border-radius: 18px;
        box-shadow: 0 4px 16px rgba(0,0,0,0.08);
        margin-bottom: 24px;
        border: none;
        overflow: visible;
        min-height: 340px;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        padding: 0;
        width: 100%;
        max-width: 100%;
    }

    .card-status.Aprovado {
        background: linear-gradient(135deg, #52f352 0%, #eaffea 100%);
    }
    .card-status.Reprovado {
        background: linear-gradient(135deg, #f53db2 0%, #ffeaea 100%);
    }
    .card-status.Pendente {
        background: linear-gradient(135deg, #f5ff49 0%, #f7f7f7 100%);
    }
    .card-status.Configurado {
        background: linear-gradient(135deg, #ffd500 0%, #fff7e6 100%);
    }
    .card-status.Reprovado-pelo-CEO {
        background: linear-gradient(135deg, #ff4300 0%, #ffeaea 100%);
    }
    .card-status.Aprovado-pelo-CEO {
        background: linear-gradient(135deg, #69e969 0%, #eaffea 100%);
    }
    .card-status.Reprovado-pela-Diretoria {
        background: linear-gradient(135deg, #ff6147 0%, #ffeaea 100%);
    }
    .card-status.Aprovado-pela-Diretoria {
        background: linear-gradient(135deg, #4680b4 0%, #e6f0ff 100%);
    }
    .card-status.Expedido {
        background: linear-gradient(135deg, #ff8a00 0%, #fff7e6 100%);
    }
    .card-status.Enviado-para-o-Cliente {
        background: linear-gradient(135deg, #1e80ff 0%, #e6f0ff 100%);
    }
    .card-status.Aprovado-Inteligencia {
        background: linear-gradient(135deg, #ba95d8 0%, #f7f7f7 100%);
    }

    .card-body {
        padding: 20px 10px 16px 18px;
        display: flex;
        flex-direction: column;
        gap: 6px;
        background: #fff;
        border-radius: 18px;
        box-shadow: none;
        width: 100%;
        overflow: visible;
    }
    .card-body h3 {
        font-size: 1.1rem;
        font-weight: 700;
        color: #555;
        margin-bottom: 10px;
    }
    .card-title {
        font-size: 1.3rem;
        font-weight: 600;
        color: #333;
        margin-bottom: 8px;
    }
    .card-text, .col-form-label {
        font-size: 0.95rem;
        color: #444;
        margin-bottom: 3px;
        transition: color 0.2s, transform 0.2s;
        word-wrap: break-word;
        overflow-wrap: break-word;
        line-height: 1.3;
    }
    .col-form-label:hover {
        transform: translateY(-3px);
        color: #007bff;
    }
    .btn {
        margin-right: 6px;
        margin-bottom: 6px;
        border-radius: 8px;
        font-size: 0.9rem;
        font-weight: 500;
        padding: 6px 12px;
        min-width: 80px;
    }
    @media (max-width: 991px) {
        .col-md-4 {
            flex: 0 0 100%;
            max-width: 100%;
        }
    }
    @media (max-width: 767px) {
        .col-md-4 {
            flex: 0 0 100%;
            max-width: 100%;
        }
        .container {
            padding-left: 8px;
            padding-right: 8px;
        }
        .card-body {
            padding: 14px 4px;
        }
        .btn {
            width: 100%;
            margin-right: 0;
        }
    }

    .card-status:hover {
        transform: scale(1.04);
        box-shadow: 0 8px 32px rgba(0,0,0,0.12);
    }

    .card-title {
        font-size: 1.3rem;
        font-weight: 600;
        color: #333;
        margin-bottom: 8px;
    }

    .card-text, .col-form-label {
        font-size: 1rem;
        color: #444;
        margin-bottom: 4px;
        transition: color 0.2s, transform 0.2s;
    }
    .col-form-label:hover {
        transform: translateY(-3px);
        color: #007bff;
    }

    .card-body h3 {
        font-size: 1.1rem;
        font-weight: 700;
        color: #555;
        margin-bottom: 10px;
    }

    .btn {
        margin-right: 8px;
        margin-bottom: 8px;
        border-radius: 8px;
        font-size: 0.95rem;
        font-weight: 500;
        padding: 8px 16px;
    }

    @media (max-width: 991px) {
        .col-md-4 {
            flex: 0 0 50%;
            max-width: 50%;
        }
    }
    @media (max-width: 767px) {
        .col-md-4 {
            flex: 0 0 100%;
            max-width: 100%;
        }
        .container {
            padding-left: 8px;
            padding-right: 8px;
        }
        .card-body {
            padding: 16px 8px;
        }
        .btn {
            width: 100%;
            margin-right: 0;
        }
    }
    .form-control, .form-select {
        border-radius: 8px;
        font-size: 1rem;
        margin-bottom: 8px;
    }
    .btn-primary {
        background: linear-gradient(90deg, #007bff 0%, #0056b3 100%);
        border: none;
    }
    
    /* Estilo para equipamentos truncados */
    .equipamentos-truncados {
        color: #666;
        font-style: italic;
    }
    .equipamentos-truncados:hover {
        color: #333;
    }
    
    /* Estilo para lista de equipamentos compacta */
    .equipamentos-lista {
        display: inline-block;
        max-width: 100%;
        word-wrap: break-word;
        line-height: 1.2;
        font-size: 0.9rem;
        color: #555;
    }
    
    /* Reduzir espaçamento das linhas */
    .mb-1 {
        margin-bottom: 0.25rem !important;
    }
    
    /* Garantir que os botões sempre apareçam */
    .card-body form {
        display: flex;
        flex-direction: column;
    }
    
    .card-body form .btn {
        margin-top: 8px;
        display: inline-block;
        visibility: visible !important;
        opacity: 1 !important;
    }
    
    .mt-3 {
        margin-top: 1rem !important;
        padding-top: 8px;
        border-top: 1px solid #eee;
    }
</style>
<script>
   document.querySelectorAll('.add-equipamento').forEach(function(button) {
        button.addEventListener('click', function() {
            var containerId = this.getAttribute('data-container-id');
            var container = document.getElementById(containerId);
            var newField = document.createElement('textarea');
            newField.setAttribute('name', 'id_equipamentos');
            newField.setAttribute('class', 'form-control');
            container.appendChild(newField);
        });
    });

    document.addEventListener('DOMContentLoaded', function() {
        var cnpjAlert = document.getElementById('cnpj-alert');
        var cnpjValue = ['61.150.751/0025-56','61.150.751/0091-35','61.150.751/0038-70','61.150.751/0035-28','61.150.751/0033-66','61.150.751/0031-02','61.150.751/0025-56']; // Valor do CNPJ a ser verificado
        var cnpjFields = document.querySelectorAll('.col-form-label');

        cnpjFields.forEach(function(field) {
            if (field.textContent.includes(cnpjValue)) {
                var cardBody = field.closest('.card-body');
                var idLabel = Array.from(cardBody.querySelectorAll('label')).find(label => label.textContent.includes('ID:'));
                var requisicaoId = idLabel ? idLabel.textContent.split(': ')[1] : 'N/A';
                cnpjAlert.innerHTML = `<strong>Atenção!</strong> Os ID´s da requisição de ID ( ${requisicaoId} ) com CNPJ ( ${cnpjValue} ) devem ser espelhados para o grid da KRONA_INTEGRACAO`;
                cnpjAlert.style.display = 'block';
            }
        });
    });
</script>
<div id="cnpj-alert" class="alert alert-danger" style="display: none;"></div>
<div class="container mt-4">
        <div style="background-color: #444a4d; padding: 16px 0; text-align: center;">
            <span style="color: #ffd600; font-size: 2rem; font-weight: bold;">CONFIGURAÇÃO</span>
        </div>
    <div class="row">
        {% for registro in equipamentos %}
            {% if registro.status == 'Aprovado pelo CEO' %}
                <div class="col-md-4 mb-4">
                    <div class="card card-status {% if registro.status == 'Aprovado' %}Aprovado{% elif registro.status == 'Reprovado' %}Reprovado{% elif registro.status == 'Configurado' %}Configurado{% elif registro.status == 'Pendente' %}Pendente{% elif registro.status == 'Expedido' %}Expedido{% elif registro.status == 'Reprovado pelo CEO' %}Reprovado-pelo-CEO{% elif registro.status == 'Aprovado pelo CEO' %}Aprovado-pelo-CEO{% elif registro.status == 'Reprovado pela Diretoria' %}Reprovado-pela-Diretoria{% elif registro.status == 'Aprovado pela Diretoria' %}Aprovado-pela-Diretoria{% elif registro.status == 'Enviado para o Cliente' %}Enviado-para-o-Cliente{% elif registro.status == 'Aprovado Inteligência' %}Aprovado-Inteligencia{% endif %}">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-center mb-2">
                                {% if registro.status == 'Aprovado pelo CEO' %}
                                    <h3 style="font-size:1.1rem;font-weight:700;color:#555;">Requisição</h3>
                                {% else %}
                                    <h3 style="font-size:1.1rem;font-weight:700;color:#555;">Manutenção</h3>
                                {% endif %}
                                <span class="badge bg-secondary" style="font-size:0.95rem;">ID: {{ registro.id }}</span>
                            </div>
                            <form method="post" class="requisicao-form">
                                {% csrf_token %}
                                <div class="mb-1 row">
                                    <label class="col-sm-12 col-form-label" style="white-space:normal;"><b>Nome:</b> {{ registro.nome.nome }}</label>
                                </div>
                                {% if registro.data_entrega %}
                                <div class="mb-1 row">
                                    <div class="col-sm-6 col-form-label"><b style="color:#100cf7;">Data de Entrega:</b> {{ registro.data_entrega|date:"d/m/Y" }}</div>
                                    <div class="col-sm-6 col-form-label"><b>CNPJ:</b> {{ registro.cnpj }}</div>
                                </div>
                                {% endif %}
                                <div class="mb-1 row">
                                    <label class="col-sm-12 col-form-label"><b>Endereço:</b> {{ registro.endereco }}</label>
                                </div>
                                    <div class="mb-1 row">
                                        <div class="col-sm-6 col-form-label"><b>Data de Criação:</b> {{ registro.data_alteracao|date:'d/m/Y H:i:s' }}</div>
                                        <div class="col-sm-6 col-form-label"><b>Data Alteração:</b> {{ registro.data|date:'d/m/Y H:i:s' }}</div>
                                    </div>
                               
                                
                                <div class="mb-1 row">
                                    <div class="col-sm-6 col-form-label"><b>Comercial:</b> {{ registro.comercial }}</div>
                                    <div class="col-sm-6 col-form-label"><b style="color:#100cf7;">Tipo de Produto:</b> {{ registro.tipo_produto }}</div>
                                </div>
                                {% if registro.antenista %}
                                <div class="mb-1 row">
                                    <label class="col-sm-6 col-form-label"><b>Antenista : </b> {{ registro.antenista }}</label>
                                </div>
                                {% endif %}
                               
                                <div class="mb-1 row">
                                    <div class="col-sm-6 col-form-label"><b>Tipo de Contrato:</b> {{ registro.contrato }}</div>
                                    <div class="col-sm-6 col-form-label"><b style="color:#100cf7;">Customização:</b> {{ registro.tipo_customizacao }}</div>
                                </div>
                                <div class="mb-1 row">
                                    <div class="col-sm-6 col-form-label"><b>Taxa envio:</b> {{ registro.taxa_envio }}</div>
                                    <div class="col-sm-6 col-form-label"><b style="color:#100cf7;">Quantidade:</b> {{ registro.numero_de_equipamentos }}</div>
                                </div>
                                <div class="mb-1 row">
                                    <label class="col-sm-6 col-form-label"><b style="color:#100cf7;">TP:</b> {{ registro.TP }}</label>
                                </div>
                                <div class="mb-1 row">
                                    <label class="col-sm-6 col-form-label">
                                        <b>ID Equipamentos:</b> 
                                        {% if registro.id_equipamentos %}
                                            {% with equipamentos=registro.id_equipamentos.split %}
                                                {% if equipamentos|length > 3 %}
                                                    <span title="{{ registro.id_equipamentos }}" style="cursor: help;" class="equipamentos-truncados equipamentos-lista">
                                                        {{ equipamentos.0 }}, {{ equipamentos.1 }}, {{ equipamentos.2 }}... (+{{ equipamentos|length|add:"-3" }} mais)
                                                    </span>
                                                {% else %}
                                                    <span class="equipamentos-lista">{{ registro.id_equipamentos }}</span>
                                                {% endif %}
                                            {% endwith %}
                                        {% else %}
                                            Não informado
                                        {% endif %}
                                    </label>
                                </div>
                                <div class="mb-1 row">
                                    <label class="col-sm-12 col-form-label" style="white-space:normal;"><b>Observações:</b> {{ registro.observacoes }}</label>
                                </div>
                                <div class="mt-3">
                                    <a class="btn btn-info" href="{% url 'gerar_pdf_saida' registro.id %}">Download PDF</a>

                                {% if registro.status == 'Aprovado pelo CEO' %}
                                    <a href="{% url 'expedir_requisicao' registro.id %}" class="btn btn-primary">Expedir Requisição</a>
					{% if perms.produto.delete_produto %}
                                    <a href="{% url 'ConfiguracaoUpdateView' registro.id %}" class="btn btn-secondary">Incluir ID</a>
					{% endif %}
                                    {% if perms.nestle.delete_gridinternacional %}
                                    <a href="{% url 'requisicoesdeleteview' registro.id %}" class="btn btn-danger">Excluir</a>
                                    {% endif %}
                                {% elif registro.status == 'Aprovado pela Diretoria' %}
                                    <a href="{% url 'expedir_manutencao' registro.id %}" class="btn btn-primary">Expedir Manutenção</a>
                                    <a href="{% url 'ConfiguracaoUpdateView2' registro.id %}" class="btn btn-secondary">Editar Manutenção</a>
                                {% elif registro.status == 'Aprovado Inteligência' %}
                                    <a href="{% url 'expedir_manutencao' registro.id %}" class="btn btn-primary">Expedir Manutenção</a>
                                    <a href="{% url 'ConfiguracaoUpdateView2' registro.id %}" class="btn btn-secondary">Editar Manutenção</a>
                                {% else %}
                                    <a href="{% url 'expedir_manutencao' registro.id %}" class="btn btn-primary">Expedir Manutenção</a>
                                {% endif %}
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
	                {% endif %}
                {% endfor %}    
    </div>
</div>

{% endblock %}
