{% extends 'base.html' %}
{% block content %}
<link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">

<style>
    body {
        background-color: #45494E; /* Cor de fundo mais escura */
        display: flex;
        flex-direction: column;
        height: 100vh;
        margin: 0;
    }
    .container-fluid {
        padding: 0;
    }
    .row {
        margin: 0;
    }
    .table-responsive {
        padding: 0 15px;
        margin-left: 0;
        width: 100%;
    }
    .form-control {
        width: 100%;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }
    .dropdown-status {
        width: 10rem; /* Ajuste a largura conforme necessário */
    }
    .filter-container {
        display: flex;
        flex-wrap: nowrap;
        gap: 0rem; /* Aumente o espaçamento entre os campos */
    }
    .thead-dark {
        background-color: #344038; /* Substitua pelo valor exato da cor da sua barra de navegação */
        color: white;
    }
    .texto {
        text-align: center; /* Centraliza o texto */
        color: white; /* Define a cor do texto como branco */
    }
    .table {
        background-color: white;
        border-radius: 8px;
        overflow: hidden;
        box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    .table th {
        border-top: none;
        font-weight: 600;
    }
    .table td {
        vertical-align: middle;
    }
    .btn-primary {
        background-color: #007bff;
        border-color: #007bff;
    }
    .btn-primary:hover {
        background-color: #0056b3;
        border-color: #0056b3;
    }
</style>
<br>
<br>
<br>
<div class="container mt-5">
    <div class="texto">
        <h2>Consulta de Requisições</h2>
    </div>

    <form method="GET" action="">
        <div class="row mb-3">
            <div class="col">
                <input type="text" name="ID" class="form-control" placeholder="ID do Equipamento" value="{{ request.GET.ID }}">
            </div>
            <div class="col">
                <input type="text" name="ICCID_NOVO" class="form-control" placeholder="ICCID" value="{{ request.GET.ICCID_NOVO }}">
            </div>
            <div class="col">
                <input type="text" name="CLIENTE" class="form-control" placeholder="Nome do Cliente" value="{{ request.GET.CLIENTE }}">
            </div>
            <div class="col">
                <button class="btn btn-primary" type="submit">Filtrar</button>
                <a href="{% url 'listar_qualits' %}" class="btn btn-secondary">Limpar</a>
            </div>
        </div>
    </form>

    {% if request.GET.ID or request.GET.ICCID_NOVO or request.GET.CLIENTE %}
        {% if qualits.exists %}
        <div class="table-responsive">
            <table class="table table-striped">
                <thead class="thead-dark">
                    <tr>
                        <th>Nº</th>
                        <th>ID Requisição</th>
                        <th>Cliente</th>
                        <th>ID Equipamentos</th>
                        <th>ICCID</th>
                        <th>Contrato</th>
                        <th>Comercial</th>
                        <th>Status</th>
                        <th>Data Alteração</th>
                    </tr>
                </thead>
                <tbody>
                    {% for qualit in qualits %}
                    <tr>
                        <td>{{ forloop.counter }}</td>
                        <td>{{ qualit.id }}</td>
                        <td>{{ qualit.nome.nome|default:"N/A" }}</td>
                        <td>
                            {% if qualit.id_equipamentos %}
                                {{ qualit.id_equipamentos|truncatechars:50 }}
                            {% else %}
                                N/A
                            {% endif %}
                        </td>
                        <td>
                            {% if qualit.iccid %}
                                {{ qualit.iccid|truncatechars:50 }}
                            {% else %}
                                N/A
                            {% endif %}
                        </td>
                        <td>{{ qualit.contrato|default:"N/A" }}</td>
                        <td>{{ qualit.comercial|default:"N/A" }}</td>
                        <td>
                            <span class="badge badge-{% if qualit.status == 'Aprovado pelo CEO' %}success{% elif qualit.status == 'Pendente' %}warning{% elif qualit.status == 'Reprovado' %}danger{% else %}secondary{% endif %}">
                                {{ qualit.status|default:"N/A" }}
                            </span>
                        </td>
                        <td>{{ qualit.data_alteracao|date:"d/m/Y H:i"|default:"N/A" }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        <div class="text-center mt-3">
            <p class="text-white">Total de registros encontrados: {{ qualits.count }}</p>
        </div>
        {% else %}
        <div class="alert alert-info text-center mt-3">
            <p class="text-white">Nenhum resultado encontrado para os filtros aplicados.</p>
        </div>
        {% endif %}
    {% else %}
        <div class="alert alert-info text-center mt-3">
            <p class="text-white">Use os filtros acima para buscar requisições.</p>
        </div>
    {% endif %}
</div>
{% endblock %}

